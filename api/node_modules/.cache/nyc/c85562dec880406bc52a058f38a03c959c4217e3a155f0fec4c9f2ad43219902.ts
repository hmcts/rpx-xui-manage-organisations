"use strict";var cov_1hmai6twz3=function(){var path="/home/alan/Cloud/workspaces/prd-pui-manager/api/lib/interceptors.ts";var hash="956ffbaaac2c90a1837d7219402ac361ef3cdec2";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/home/alan/Cloud/workspaces/prd-pui-manager/api/lib/interceptors.ts",statementMap:{"0":{start:{line:2,column:0},end:{line:2,column:62}},"1":{start:{line:3,column:25},end:{line:3,column:55}},"2":{start:{line:4,column:16},end:{line:4,column:46}},"3":{start:{line:5,column:15},end:{line:5,column:34}},"4":{start:{line:6,column:17},end:{line:6,column:45}},"5":{start:{line:7,column:13},end:{line:7,column:35}},"6":{start:{line:8,column:14},end:{line:8,column:34}},"7":{start:{line:9,column:23},end:{line:11,column:1}},"8":{start:{line:13,column:17},end:{line:13,column:46}},"9":{start:{line:14,column:14},end:{line:14,column:70}},"10":{start:{line:15,column:4},end:{line:15,column:61}},"11":{start:{line:17,column:4},end:{line:17,column:49}},"12":{start:{line:18,column:4},end:{line:18,column:24}},"13":{start:{line:19,column:4},end:{line:19,column:70}},"14":{start:{line:20,column:4},end:{line:20,column:41}},"15":{start:{line:21,column:4},end:{line:21,column:31}},"16":{start:{line:22,column:4},end:{line:22,column:77}},"17":{start:{line:23,column:4},end:{line:23,column:19}},"18":{start:{line:25,column:0},end:{line:25,column:48}},"19":{start:{line:27,column:4},end:{line:27,column:50}},"20":{start:{line:28,column:4},end:{line:28,column:94}},"21":{start:{line:29,column:17},end:{line:29,column:44}},"22":{start:{line:30,column:14},end:{line:30,column:78}},"23":{start:{line:31,column:4},end:{line:37,column:7}},"24":{start:{line:38,column:4},end:{line:38,column:118}},"25":{start:{line:39,column:4},end:{line:39,column:20}},"26":{start:{line:41,column:0},end:{line:41,column:48}},"27":{start:{line:43,column:4},end:{line:43,column:47}},"28":{start:{line:44,column:4},end:{line:44,column:85}},"29":{start:{line:45,column:17},end:{line:45,column:44}},"30":{start:{line:46,column:14},end:{line:46,column:75}},"31":{start:{line:48,column:4},end:{line:54,column:7}},"32":{start:{line:55,column:17},end:{line:55,column:108}},"33":{start:{line:56,column:15},end:{line:56,column:65}},"34":{start:{line:57,column:4},end:{line:63,column:5}},"35":{start:{line:58,column:8},end:{line:58,column:114}},"36":{start:{line:59,column:8},end:{line:59,column:192}},"37":{start:{line:62,column:8},end:{line:62,column:170}},"38":{start:{line:64,column:4},end:{line:64,column:71}},"39":{start:{line:65,column:4},end:{line:65,column:73}},"40":{start:{line:66,column:4},end:{line:66,column:42}},"41":{start:{line:68,column:0},end:{line:68,column:44}}},fnMap:{"0":{name:"requestInterceptor",decl:{start:{line:12,column:9},end:{line:12,column:27}},loc:{start:{line:12,column:37},end:{line:24,column:1}},line:12},"1":{name:"successInterceptor",decl:{start:{line:26,column:9},end:{line:26,column:27}},loc:{start:{line:26,column:38},end:{line:40,column:1}},line:26},"2":{name:"errorInterceptor",decl:{start:{line:42,column:9},end:{line:42,column:25}},loc:{start:{line:42,column:33},end:{line:67,column:1}},line:42}},branchMap:{"0":{loc:{start:{line:55,column:17},end:{line:55,column:108}},type:"cond-expr",locations:[{start:{line:55,column:64},end:{line:55,column:85}},{start:{line:55,column:88},end:{line:55,column:108}}],line:55},"1":{loc:{start:{line:57,column:4},end:{line:63,column:5}},type:"if",locations:[{start:{line:57,column:4},end:{line:63,column:5}},{start:{line:57,column:4},end:{line:63,column:5}}],line:57},"2":{loc:{start:{line:58,column:15},end:{line:58,column:113}},type:"cond-expr",locations:[{start:{line:58,column:62},end:{line:58,column:106}},{start:{line:58,column:109},end:{line:58,column:113}}],line:58}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0},f:{"0":0,"1":0,"2":0},b:{"0":[0,0],"1":[0,0],"2":[0,0]},_coverageSchema:"43e27e138ebf9cfc5966b082cf9a028302ed4184",hash:"956ffbaaac2c90a1837d7219402ac361ef3cdec2"};var coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}return coverage[path]=coverageData;}();cov_1hmai6twz3.s[0]++;Object.defineProperty(exports,"__esModule",{value:true});var exceptionFormatter=(cov_1hmai6twz3.s[1]++,require("exception-formatter"));var stringify=(cov_1hmai6twz3.s[2]++,require("json-stringify-safe"));var config_1=(cov_1hmai6twz3.s[3]++,require("./config"));var errorStack=(cov_1hmai6twz3.s[4]++,require("../lib/errorStack"));var util_1=(cov_1hmai6twz3.s[5]++,require("../lib/util"));var log4jui=(cov_1hmai6twz3.s[6]++,require("./log4jui"));var exceptionOptions=(cov_1hmai6twz3.s[7]++,{maxLines:1});function requestInterceptor(request){cov_1hmai6twz3.f[0]++;var logger=(cov_1hmai6twz3.s[8]++,log4jui.getLogger('outgoing'));var url=(cov_1hmai6twz3.s[9]++,util_1.shorten(request.url,config_1.default.maxLogLine));cov_1hmai6twz3.s[10]++;logger.info(request.method.toUpperCase()+" to "+url);//add timings to requests
cov_1hmai6twz3.s[11]++;request.metadata={startTime:new Date()};cov_1hmai6twz3.s[12]++;logger.info('Auth');cov_1hmai6twz3.s[13]++;logger.info(JSON.stringify(request.headers.common.Authorization));cov_1hmai6twz3.s[14]++;logger.info('---------------------');cov_1hmai6twz3.s[15]++;logger.info('header FULL');cov_1hmai6twz3.s[16]++;logger.info(JSON.stringify(request.headers.common.ServiceAuthorization));cov_1hmai6twz3.s[17]++;return request;}cov_1hmai6twz3.s[18]++;exports.requestInterceptor=requestInterceptor;function successInterceptor(response){cov_1hmai6twz3.f[1]++;cov_1hmai6twz3.s[19]++;response.config.metadata.endTime=new Date();cov_1hmai6twz3.s[20]++;response.duration=response.config.metadata.endTime-response.config.metadata.startTime;var logger=(cov_1hmai6twz3.s[21]++,log4jui.getLogger('return'));var url=(cov_1hmai6twz3.s[22]++,util_1.shorten(response.config.url,config_1.default.maxLogLine));cov_1hmai6twz3.s[23]++;logger.trackRequest({duration:response.duration,name:"Service "+response.config.method.toUpperCase()+" call",resultCode:response.status,success:true,url:response.config.url});cov_1hmai6twz3.s[24]++;logger.info("Success on "+response.config.method.toUpperCase()+" to "+url+" ("+response.duration+")");cov_1hmai6twz3.s[25]++;return response;}cov_1hmai6twz3.s[26]++;exports.successInterceptor=successInterceptor;function errorInterceptor(error){cov_1hmai6twz3.f[2]++;cov_1hmai6twz3.s[27]++;error.config.metadata.endTime=new Date();cov_1hmai6twz3.s[28]++;error.duration=error.config.metadata.endTime-error.config.metadata.startTime;var logger=(cov_1hmai6twz3.s[29]++,log4jui.getLogger('return'));var url=(cov_1hmai6twz3.s[30]++,util_1.shorten(error.config.url,config_1.default.maxLogLine));// application insights logging
cov_1hmai6twz3.s[31]++;logger.trackRequest({duration:error.duration,name:"Service "+error.config.method.toUpperCase()+" call",resultCode:error.status,success:true,url:error.config.url});var status=(cov_1hmai6twz3.s[32]++,util_1.valueOrNull(error,'response.status')?(cov_1hmai6twz3.b[0][0]++,error.response.status):(cov_1hmai6twz3.b[0][1]++,Error(error).message));var data=(cov_1hmai6twz3.s[33]++,util_1.valueOrNull(error,'response.data.details'));cov_1hmai6twz3.s[34]++;if(!data){cov_1hmai6twz3.b[1][0]++;cov_1hmai6twz3.s[35]++;data=util_1.valueOrNull(error,'response.status')?(cov_1hmai6twz3.b[2][0]++,JSON.stringify(error.response.data,null,2)):(cov_1hmai6twz3.b[2][1]++,null);cov_1hmai6twz3.s[36]++;logger.error("Error on "+error.config.method.toUpperCase()+" to "+url+" in ("+error.duration+") - "+error+" \n\n        "+exceptionFormatter(data,exceptionOptions));}else{cov_1hmai6twz3.b[1][1]++;cov_1hmai6twz3.s[37]++;logger.error("Error on "+error.config.method.toUpperCase()+" to "+url+" in ("+error.duration+") - "+error+" \n\n        "+JSON.stringify(data));}cov_1hmai6twz3.s[38]++;errorStack.push(['request',JSON.parse(stringify(error.request))]);cov_1hmai6twz3.s[39]++;errorStack.push(['response',JSON.parse(stringify(error.response))]);cov_1hmai6twz3.s[40]++;return Promise.reject(error.response);}cov_1hmai6twz3.s[41]++;exports.errorInterceptor=errorInterceptor;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiL2hvbWUvYWxhbi9DbG91ZC93b3Jrc3BhY2VzL3ByZC1wdWktbWFuYWdlci9hcGkvbGliL2ludGVyY2VwdG9ycy50cyIsInNvdXJjZXMiOlsiL2hvbWUvYWxhbi9DbG91ZC93b3Jrc3BhY2VzL3ByZC1wdWktbWFuYWdlci9hcGkvbGliL2ludGVyY2VwdG9ycy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLHdEQUF5RDtBQUN6RCwrQ0FBZ0Q7QUFDaEQsbUNBQTZCO0FBQzdCLDhDQUErQztBQUMvQyxvQ0FBa0Q7QUFFbEQsbUNBQW9DO0FBRXBDLElBQU0sZ0JBQWdCLEdBQUc7SUFDckIsUUFBUSxFQUFFLENBQUM7Q0FDZCxDQUFBO0FBRUQsNEJBQW1DLE9BQU87SUFDdEMsSUFBTSxNQUFNLEdBQUcsT0FBTyxDQUFDLFNBQVMsQ0FBQyxVQUFVLENBQUMsQ0FBQTtJQUU1QyxJQUFNLEdBQUcsR0FBRyxjQUFPLENBQUMsT0FBTyxDQUFDLEdBQUcsRUFBRSxnQkFBTSxDQUFDLFVBQVUsQ0FBQyxDQUFBO0lBQ25ELE1BQU0sQ0FBQyxJQUFJLENBQUksT0FBTyxDQUFDLE1BQU0sQ0FBQyxXQUFXLEVBQUUsWUFBTyxHQUFLLENBQUMsQ0FBQTtJQUN4RCx5QkFBeUI7SUFDekIsT0FBTyxDQUFDLFFBQVEsR0FBRyxFQUFFLFNBQVMsRUFBRSxJQUFJLElBQUksRUFBRSxFQUFFLENBQUE7SUFFNUMsTUFBTSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQTtJQUNuQixNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQTtJQUNqRSxNQUFNLENBQUMsSUFBSSxDQUFDLHVCQUF1QixDQUFDLENBQUE7SUFDcEMsTUFBTSxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsQ0FBQTtJQUMxQixNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMs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SyxDQUFDLGNBQVksS0FBSyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsV0FBVyxFQUFFLFlBQU8sR0FBRyxhQUFRLEtBQUssQ0FBQyxRQUFRLFlBQU8sS0FBSyxxQkFDcEcsa0JBQWtCLENBQUMsSUFBSSxFQUFFLGdCQUFnQixDQUFHLENBQUMsQ0FBQTtLQUNsRDtTQUFNO1FBQ0gsTUFBTSxDQUFDLEtBQUssQ0FBQyxjQUFZLEtBQUssQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLFdBQVcsRUFBRSxZQUFPLEdBQUcsYUFBUSxLQUFLLENBQUMsUUFBUSxZQUFPLEtBQUsscUJBQ3BHLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFHLENBQUMsQ0FBQTtLQUM1QjtJQUVELFVBQVUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxTQUFTLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFBO0lBQ2xFLFVBQVUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxVQUFVLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFBO0lBRXBFLE9BQU8sT0FBTyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLENBQUE7QUFDekMsQ0FBQztBQWhDRCw0Q0FnQ0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBleGNlcHRpb25Gb3JtYXR0ZXIgZnJvbSAnZXhjZXB0aW9uLWZvcm1hdHRlcidcbmltcG9ydCAqIGFzIHN0cmluZ2lmeSBmcm9tICdqc29uLXN0cmluZ2lmeS1zYWZlJ1xuaW1wb3J0IGNvbmZpZyBmcm9tICcuL2NvbmZpZydcbmltcG9ydCAqIGFzIGVycm9yU3RhY2sgZnJvbSAnLi4vbGliL2Vycm9yU3RhY2snXG5pbXBvcnQgeyBzaG9ydGVuLCB2YWx1ZU9yTnVsbCB9IGZyb20gJy4uL2xpYi91dGlsJ1xuaW1wb3J0IHsgY2xpZW50IH0gZnJvbSAnLi9hcHBJbnNpZ2h0cydcbmltcG9ydCAqIGFzIGxvZzRqdWkgZnJvbSAnLi9sb2c0anVpJ1xuXG5jb25zdCBleGNlcHRpb25PcHRpb25zID0ge1xuICAgIG1heExpbmVzOiAxLFxufVxuXG5leHBvcnQgZnVuY3Rpb24gcmVxdWVzdEludGVyY2VwdG9yKHJlcXVlc3QpIHtcbiAgICBjb25zdCBsb2dnZXIgPSBsb2c0anVpLmdldExvZ2dlcignb3V0Z29pbmcnKVxuXG4gICAgY29uc3QgdXJsID0gc2hvcnRlbihyZXF1ZXN0LnVybCwgY29uZmlnLm1heExvZ0xpbmUpXG4gICAgbG9nZ2VyLmluZm8oYCR7cmVxdWVzdC5tZXRob2QudG9VcHBlckNhc2UoKX0gdG8gJHt1cmx9YClcbiAgICAvL2FkZCB0aW1pbmdzIHRvIHJlcXVlc3RzXG4gICAgcmVxdWVzdC5tZXRhZGF0YSA9IHsgc3RhcnRUaW1lOiBuZXcgRGF0ZSgpIH1cblxuICAgIGxvZ2dlci5pbmZvKCdBdXRoJylcbiAgICBsb2dnZXIuaW5mbyhKU09OLnN0cmluZ2lmeShyZXF1ZXN0LmhlYWRlcnMuY29tbW9uLkF1dGhvcml6YXRpb24pKVxuICAgIGxvZ2dlci5pbmZvKCctLS0tLS0tLS0tLS0tLS0tLS0tLS0nKVxuICAgIGxvZ2dlci5pbmZvKCdoZWFkZXIgRlVMTCcpXG4gICAgbG9nZ2VyLmluZm8oSlNPTi5zdHJpbmdpZnkocmVxdWVzdC5oZWFkZXJzLmNvbW1vbi5TZXJ2aWNlQXV0aG9yaXphdGlvbikpXG4gICAgcmV0dXJuIHJlcXVlc3Rcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHN1Y2Nlc3NJbnRlcmNlcHRvcihyZXNwb25zZSkge1xuICAgIHJlc3BvbnNlLmNvbmZpZy5tZXRhZGF0YS5lbmRUaW1lID0gbmV3IERhdGUoKVxuICAgIHJlc3BvbnNlLmR1cmF0aW9uID0gcmVzcG9uc2UuY29uZmlnLm1ldGFkYXRhLmVuZFRpbWUgLSByZXNwb25zZS5jb25maWcubWV0YWRhdGEuc3RhcnRUaW1lXG5cbiAgICBjb25zdCBsb2dnZXIgPSBsb2c0anVpLmdldExvZ2dlcigncmV0dXJuJylcblxuICAgIGNvbnN0IHVybCA9IHNob3J0ZW4ocmVzcG9uc2UuY29uZmlnLnVybCwgY29uZmlnLm1heExvZ0xpbmUpXG5cbiAgICBsb2dnZXIudHJhY2tSZXF1ZXN0KHtcbiAgICAgICAgZHVyYXRpb246IHJlc3BvbnNlLmR1cmF0aW9uLFxuICAgICAgICBuYW1lOiBgU2VydmljZSAke3Jlc3BvbnNlLmNvbmZpZy5tZXRob2QudG9VcHBlckNhc2UoKX0gY2FsbGAsXG4gICAgICAgIHJlc3VsdENvZGU6IHJlc3BvbnNlLnN0YXR1cyxcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgdXJsOiByZXNwb25zZS5jb25maWcudXJsLFxuICAgIH0pXG5cbiAgICBsb2dnZXIuaW5mbyhgU3VjY2VzcyBvbiAke3Jlc3BvbnNlLmNvbmZpZy5tZXRob2QudG9VcHBlckNhc2UoKX0gdG8gJHt1cmx9ICgke3Jlc3BvbnNlLmR1cmF0aW9ufSlgKVxuICAgIHJldHVybiByZXNwb25zZVxufVxuXG5leHBvcnQgZnVuY3Rpb24gZXJyb3JJbnRlcmNlcHRvcihlcnJvcikge1xuICAgIGVycm9yLmNvbmZpZy5tZXRhZGF0YS5lbmRUaW1lID0gbmV3IERhdGUoKVxuICAgIGVycm9yLmR1cmF0aW9uID0gZXJyb3IuY29uZmlnLm1ldGFkYXRhLmVuZFRpbWUgLSBlcnJvci5jb25maWcubWV0YWRhdGEuc3RhcnRUaW1lXG5cbiAgICBjb25zdCBsb2dnZXIgPSBsb2c0anVpLmdldExvZ2dlcigncmV0dXJuJylcblxuICAgIGNvbnN0IHVybCA9IHNob3J0ZW4oZXJyb3IuY29uZmlnLnVybCwgY29uZmlnLm1heExvZ0xpbmUpXG5cbiAgICAvLyBhcHBsaWNhdGlvbiBpbnNpZ2h0cyBsb2dnaW5nXG4gICAgbG9nZ2VyLnRyYWNrUmVxdWVzdCh7XG4gICAgICAgIGR1cmF0aW9uOiBlcnJvci5kdXJhdGlvbixcbiAgICAgICAgbmFtZTogYFNlcnZpY2UgJHtlcnJvci5jb25maWcubWV0aG9kLnRvVXBwZXJDYXNlKCl9IGNhbGxgLFxuICAgICAgICByZXN1bHRDb2RlOiBlcnJvci5zdGF0dXMsXG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIHVybDogZXJyb3IuY29uZmlnLnVybCxcbiAgICB9KVxuXG4gICAgY29uc3Qgc3RhdHVzID0gdmFsdWVPck51bGwoZXJyb3IsICdyZXNwb25zZS5zdGF0dXMnKSA/IGVycm9yLnJlc3BvbnNlLnN0YXR1cyA6IEVycm9yKGVycm9yKS5tZXNzYWdlXG4gICAgbGV0IGRhdGEgPSB2YWx1ZU9yTnVsbChlcnJvciwgJ3Jlc3BvbnNlLmRhdGEuZGV0YWlscycpXG4gICAgaWYgKCFkYXRhKSB7XG4gICAgICAgIGRhdGEgPSB2YWx1ZU9yTnVsbChlcnJvciwgJ3Jlc3BvbnNlLnN0YXR1cycpID8gSlNPTi5zdHJpbmdpZnkoZXJyb3IucmVzcG9uc2UuZGF0YSwgbnVsbCwgMikgOiBudWxsXG4gICAgICAgIGxvZ2dlci5lcnJvcihgRXJyb3Igb24gJHtlcnJvci5jb25maWcubWV0aG9kLnRvVXBwZXJDYXNlKCl9IHRvICR7dXJsfSBpbiAoJHtlcnJvci5kdXJhdGlvbn0pIC0gJHtlcnJvcn0gXFxuXG4gICAgICAgICR7ZXhjZXB0aW9uRm9ybWF0dGVyKGRhdGEsIGV4Y2VwdGlvbk9wdGlvbnMpfWApXG4gICAgfSBlbHNlIHtcbiAgICAgICAgbG9nZ2VyLmVycm9yKGBFcnJvciBvbiAke2Vycm9yLmNvbmZpZy5tZXRob2QudG9VcHBlckNhc2UoKX0gdG8gJHt1cmx9IGluICgke2Vycm9yLmR1cmF0aW9ufSkgLSAke2Vycm9yfSBcXG5cbiAgICAgICAgJHtKU09OLnN0cmluZ2lmeShkYXRhKX1gKVxuICAgIH1cblxuICAgIGVycm9yU3RhY2sucHVzaChbJ3JlcXVlc3QnLCBKU09OLnBhcnNlKHN0cmluZ2lmeShlcnJvci5yZXF1ZXN0KSldKVxuICAgIGVycm9yU3RhY2sucHVzaChbJ3Jlc3BvbnNlJywgSlNPTi5wYXJzZShzdHJpbmdpZnkoZXJyb3IucmVzcG9uc2UpKV0pXG5cbiAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyb3IucmVzcG9uc2UpXG59XG4iXX0=