@if (isAccountAvailableForOrg) {
  <div [ngClass]="{'govuk-form-group govuk-form-group--error' : oneOrMoreAccountInfoMissing}">
    @if (oneOrMoreAccountInfoMissing) {
      <span id="fee-error" class="govuk-error-message">
        <span class="govuk-visually-hidden">Error:</span> PBA number not found
      </span>
    }
    <table class="{{'govuk-table ' + classes}}" role="presentation">
      <caption class="govuk-table__caption">{{caption}}</caption>
      <thead class="govuk-table__head" >
        <tr class="govuk-table__row">
          @for (h of columnConfig; track h) {
            <th class="govuk-table__header" scope="col">{{h.header}}</th>
          }
        </tr>
      </thead>
      <tbody class="govuk-table__body">
        @for (r of rows; track r) {
          <tr data-selector="table-row" class="govuk-table__row">
            @for (col of columnConfig; track col; let isFirst = $first) {
              @if (isFirst && firstCellIsHeader) {
                <th data-selector="table-header" class="govuk-table__header" scope="row" >
                  @if (!col.type || col.type === 'text' || !r.routerLink) {
                    {{r[col.key]}}
                  }
                  @if (col.type === 'link' && r.routerLink) {
                    <a class="govuk-link" [routerLink]="r.routerLink">{{r[col.key]}}</a>
                  }
                </th>
              }
              @if (!(isFirst && firstCellIsHeader)) {
                <td data-selector="table-cell" class="govuk-table__cell" >
                  @if (col.type === 'date') {
                    {{formatDate(r[col.key])}}
                  }
                  @if ((oneOrMoreAccountInfoMissing && r.isAccountInfoMissing)) {
                    <font color="#b10e1e" class="govuk-!-font-weight-bold">{{r[col.key]}}</font>
                  } @else {
                    @if (!col.type || col.type === 'text' || !r.routerLink) {
                      {{r[col.key]}}
                    }
                    @if (col.type === 'link' && r.routerLink) {
                      <a class="govuk-link" [routerLink]="r.routerLink">{{r[col.key]}}</a>
                    }
                  }
                </td>
              }
            }
          </tr>
        }
      </tbody>
    </table>
  </div>
} @else {
  <app-organisation-account-missing></app-organisation-account-missing>
}
